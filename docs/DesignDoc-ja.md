# タイピングアプリケーション - R-Typing

## 背景

- **Rust の学習**  
  Rust の基本を実践的に学習したかった。
- **キーボードの活用**  
  自作キーボードをフル活用するためひたすらタイピングしたかった。

## アプリケーションの目的

### 主な目標

1. **Rust のスキルアップ**  
   Rust の以下の概念やツールの学習:
   - 変数、スコープ、型
   - ベクタ、関数
   - 所有権
   - 構造体
   - スレッドと同期・非同期処理 (`mpsc`)
   - クレートの活用 (`ratatui`, `crossterm`, `rodio`, `clap`, `rand`)
   - Clean Architecture を意識したモジュール構成
2. **タイピングの楽しさを追求**  
   手軽に、ただひたすらタイピングできる環境を提供。

## 仕様

- **単語の抽出と文生成**  
  `src/domain/sample.txt` からテキストを読み込み、マルコフ連鎖 (4-gram) を用いてランダムかつ自然な文を生成する。
- **タイピングゲームの基本動作**
  - タイトル画面で Enter を押すと開始。
  - 生成された目標文字列を入力。
  - 制限時間内にタイプする。ESC で中断して結果画面へ。
- **UI とフィードバック**
  - **TUI フレームワーク**: `ratatui` を使用し、リッチなターミナル UI を構築。
  - **リアルタイム表示**: 制限時間、WPM、現在の入力状況をリアルタイムで描画。
  - **視覚的フィードバック**: 正解文字は緑、不正解文字は背景赤で強調表示。
- **音楽と効果音**
  - **BGM**: `rodio` を使用してバックグラウンド音楽を再生 (オプション)。
  - **SE**: 正解タイプ時に正弦波 (SineWave) による効果音を再生。
- **タイピング統計**  
  WPM (Words Per Minute) をリアルタイムおよび結果画面で計算・表示。

## Architecture & Code Structure

小規模な CLI アプリケーション向けに調整された、Clean Architecture に近い階層構造を採用しています。

### Directory Layout

- **`src/main.rs`**: アプリケーションのエントリーポイント。ターミナルバックエンドの初期化、オーディオスレッドのセットアップ、タイマースレッドの起動、およびメインイベントループ (`run_app`) を担当。
- **`src/presentation/`**: UI とユーザーインタラクション層。
  - **`ui/app.rs`**: アプリケーションの状態管理 (`App` 構造体)。`AppState` (Intro, Typing, Result) の遷移、入力処理、タイマー更新を行う。
  - **`ui/render.rs`**: `ratatui` を用いた描画ロジック。各状態に応じたウィジェットのレイアウトとレンダリング。
  - **`ui/ui_handler.rs`**: `clap` を使用した CLI 引数のパース定義。
  - **`bgm_handler.rs`**: `rodio` を使用した BGM 再生管理。
  - **`sentence_handler.rs`**: ユースケース層へのアクセスを提供するファサード。
- **`src/usecase/`**: アプリケーションロジック層。
  - **`generate_sentence.rs`**: マルコフ連鎖アルゴリズムによる文生成ロジック。
  - **`wpm.rs`**: WPM 計算ロジック。
- **`src/domain/`**: ドメイン層。
  - **`entity.rs`**: サンプルテキストリソースの読み込み。

## Goals

- Rust の基本概念を理解し、実践に活かす。
- TUI アプリケーション構築のノウハウ習得。

## Non-Goal

- 複雑なユーザー認証やデータベース連携。

## Implemented UI Layout

### Title Screen (Intro)

- アスキーアートによるロゴ表示。
- "Press ENTER to start", "h for help" の操作ガイド。
- ヘルプオーバーレイ (h キーでトグル)。

### Playing Screen (Typing)

- **Header**: 残り時間、タイトル、現在の WPM を表示。残り時間は色で警告 (緑 -> 黄 -> 赤)。
- **Body**: タイピング対象のテキストを表示。入力済み文字は緑、ミスは赤背景、カーソル位置は黄色アンダーラインで表示。
- **Footer**: 総タイプ数、ミス数を表示。

### Result Screen

- タイピング結果のサマリを表示。
  - Total Time
  - Total Typing
  - Total Misses
  - Words Per Minute (WPM)

## 既知の問題

- **Raw モード時の挙動**  
  一部の環境でターミナルサイズの変更時に描画が崩れる可能性がある (再描画で修正される場合あり)。
